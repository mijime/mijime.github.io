---
machine:
  timezone: Asia/Tokyo
  post:
    - test -d ~/.yarn || curl -sSL https://yarnpkg.com/install.sh | bash

test:
  override:
    - make test

checkout:
  post:
    - git submodule sync
    - git submodule update --init --recursive

dependencies:
  cache_directories:
    - assets
    - ~/.yarn-cache
  pre:
    - git config --global user.name "CircleCI"
    - git config --global user.email "circleci@circleci.com"
    - go get -u -v github.com/spf13/hugo
  override:
    - yarn

deployment:
  release:
    branch: content
    commands:
      - make deploy
