{"pageProps":{"siteName":"My snippets","source":{"compiledSource":"var i=Object.defineProperty,N=Object.defineProperties;var h=Object.getOwnPropertyDescriptors;var t=Object.getOwnPropertySymbols;var r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;var o=(e,s,n)=>s in e?i(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,a=(e,s)=>{for(var n in s||(s={}))r.call(s,n)&&o(e,n,s[n]);if(t)for(var n of t(s))l.call(s,n)&&o(e,n,s[n]);return e},m=(e,s)=>N(e,h(s));var c=(e,s)=>{var n={};for(var p in e)r.call(e,p)&&s.indexOf(p)<0&&(n[p]=e[p]);if(e!=null&&t)for(var p of t(e))s.indexOf(p)<0&&l.call(e,p)&&(n[p]=e[p]);return n};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var p=n,{components:e}=p,s=c(p,[\"components\"]);return mdx(MDXLayout,m(a(a({},layoutProps),s),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"Python \\u306E dulwich \\u3092\\u4F7F\\u3046\\u4F8B\\u304C\\u591A\\u3044\"),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{className:\"hljs language-python\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"from\"),\" dulwich.client \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` HttpGitClient\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"from\"),\" dulwich.repo \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` MemoryRepo\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"from\"),\" urllib.parse \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` urlparse\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` itertools\n\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-keyword\"}),\"def\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-title\"}),\"fetch_repo\"),\"(\",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"repo=\",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-literal\"}),\"None\"),\", url=\",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-literal\"}),\"None\")),\"):\"),`\n    url_object = urlparse(url)\n    client = HttpGitClient(`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-string\"}),'\"://\"'),`.join([url_object.scheme, url_object.netloc]))\n    remote_refs = client.fetch(url_object.path, repo)\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"for\"),\" ref, sha1 \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"in\"),` remote_refs.items():\n        repo.refs[ref] = sha1\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` repo\n\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-keyword\"}),\"def\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-title\"}),\"get_first_commit_time\"),\"(\",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"repo\"),\"):\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"for\"),\" entry \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"in\"),` repo.get_walker():\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),\" entry.commit.commit_time\")),mdx(\"h2\",null,\"Reference\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",a({parentName:\"li\"},{href:\"https://github.com/jelmer/dulwich\"}),\"https://github.com/jelmer/dulwich\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",a({parentName:\"li\"},{href:\"http://ijin.github.io/blog/2016/02/18/ssh-and-git-on-aws-lambda/\"}),\"http://ijin.github.io/blog/2016/02/18/ssh-and-git-on-aws-lambda/\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",a({parentName:\"li\"},{href:\"https://qiita.com/shibataka000/items/910754486ba2585209b2\"}),\"https://qiita.com/shibataka000/items/910754486ba2585209b2\"))))}MDXContent.isMDXComponent=!0;\n","scope":{}},"post":{"title":"Gitがインストールされていない環境でログを取得し、ハンドリングする","description":"\nPython の dulwich を使う例が多い\n\n<!--more-->\n\n```python\nfrom dulwich.client import HttpGitClient\nfrom dulw","createdAt":"2017-10-22T12:25:19.000Z","tags":["git"],"draft":false,"slug":"python/git-fetch","content":"\nPython の dulwich を使う例が多い\n\n<!--more-->\n\n```python\nfrom dulwich.client import HttpGitClient\nfrom dulwich.repo import MemoryRepo\nfrom urllib.parse import urlparse\nimport itertools\n\ndef fetch_repo(repo=None, url=None):\n    url_object = urlparse(url)\n    client = HttpGitClient(\"://\".join([url_object.scheme, url_object.netloc]))\n    remote_refs = client.fetch(url_object.path, repo)\n    for ref, sha1 in remote_refs.items():\n        repo.refs[ref] = sha1\n    return repo\n\ndef get_first_commit_time(repo):\n    for entry in repo.get_walker():\n        return entry.commit.commit_time\n```\n\n## Reference\n\n- https://github.com/jelmer/dulwich\n- http://ijin.github.io/blog/2016/02/18/ssh-and-git-on-aws-lambda/\n- https://qiita.com/shibataka000/items/910754486ba2585209b2\n"}},"__N_SSG":true}