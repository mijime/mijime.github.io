<!DOCTYPE html><html lang="ja"><head><link rel="icon" href="/favicon.png"/><meta name="google-site-verification" content="7gVj5rzyozu0vYcQMLhIGr4g-WWyJn4R22RgeYqQdS0"/><script src="https://www.googletagmanager.com/gtag/js?id=UA-46554348-4"></script><script>
window.dataLayer = window.dataLayer || [];
window.gtag = function(){dataLayer.push(arguments);}
window.gtag('js', new Date());
window.gtag('config', 'UA-46554348-4', {page_path: window.location.pathname});
</script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title> kanazawa.rb meetup 46に参加した | My snippets</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/3118f4a5cdc48aa468ba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3118f4a5cdc48aa468ba.css" data-n-g=""/><link rel="preload" href="/_next/static/css/be10f5f7efdee9258153.css" as="style"/><link rel="stylesheet" href="/_next/static/css/be10f5f7efdee9258153.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-377d9957422d331503bc.js" defer=""></script><script src="/_next/static/chunks/framework-92300432a1172ef1338b.js" defer=""></script><script src="/_next/static/chunks/main-ff11dfa7b9d2932d51f3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-aeb6e3be34fe6d240b38.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5B...paths%5D-9248b9a62a3194e493a0.js" defer=""></script><script src="/_next/static/1cM0zPcXCmvgNJ12n612E/_buildManifest.js" defer=""></script><script src="/_next/static/1cM0zPcXCmvgNJ12n612E/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="default_defaultLayout__1hsFy"><section class="navbar-header_navbarHeader__3g5tB"><h3 class="navbar-header_navbarHeaderTitle__2ef7R"><a href="/">My snippets</a></h3></section><div class="default_defaultLayoutContent__2tmRG"><div class="card_card__DcOjB"><h1 class="article-card_title__3J6E6"><a href="/post/study/kanazawa.rb/2016/06/18/"> kanazawa.rb meetup 46に参加した</a></h1><div class="tag-list_tagList__2paiH"><span class="tag_tag__Z47f9 tag-list_tagLink__ESpk3"><a href="/tag/development/posts/1/">development</a></span><span class="tag_tag__Z47f9 tag-list_tagLink__ESpk3"><a href="/tag/lambda/posts/1/">lambda</a></span><span class="tag_tag__Z47f9 tag-list_tagLink__ESpk3"><a href="/tag/kzrb/posts/1/">kzrb</a></span><span class="tag_tag__Z47f9 tag-list_tagDate__2WCFH">5 years ago</span></div><div class="article-card_content__3af8_"><div class="prose prose_prose__2WXno"><h2>AWS Lambda を管理するツール Lamma やってみた</h2><p>Ruby で書かれた lammba というリポジトリが上がったので
ruby 勉強会に参加がてら触ってみた</p><h3><a href="https://github.com/ayemos/Lamma">lamma</a></h3><h3>作業リポジトリ</h3><p><a href="https://github.com/mijime/mijime.github.io/tree/content/source/study/kanazawa.rb/2016-06-18">source</a></p><h3>作業雑感</h3><p>シンプルな Lambda 管理ツール</p><h4>Pros</h4><ul><li>1 dir, 1 func なのでわかりやすいね</li><li>勝手に zip してくれるね</li><li>Ruby なので今後拡張しやすい、のかな？</li></ul><h4>Cons</h4><ul><li>nodejs, python2.7 のみ対応</li><li>消したりするのめんどくさそう ... まぁ関数だけだからいいんだけども ...</li><li>node_modules 入ってない？</li></ul><h3>作業ログ</h3><p>まずは環境作成</p><pre><code class="hljs language-ruby">source <span class="hljs-string">&quot;https://rubygems.org&quot;</span>

gem <span class="hljs-string">&quot;lamma&quot;</span></code></pre><pre><code>FROM ruby

COPY Gemfile /var/app/Gemfile
WORKDIR /var/app
RUN bundle install
</code></pre><pre><code>---
version: &#x27;2&#x27;
services:
  app:
    build: .
    command: sleep 3600
    environment:
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
    volumes:
      - ./scripts:/var/app/scripts
</code></pre><p>とりあえずインストールして実行してみる</p><p>AWS 関連の情報を渡して ...</p><pre><code>eval $(cat ~/.aws/credentials | awk -v FS=&quot; = &quot; &#x27;$1~/^aws/{print &quot;export&quot;,toupper($1)&quot;=&quot;$2}&#x27;)
</code></pre><p>関数を作成してみる</p><pre><code>lamma create scripts/my-function-1 --runtime python2.7

Creating function at directory ./scripts/my-function-1.
bundler: failed to load command: lamma (/usr/local/bundle/bin/lamma)
NoMethodError: undefined method `match&#x27; for nil:NilClass
Did you mean?  catch
/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/endpoint_provider.rb:67:in `block in partition_matching_region&#x27;
/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/endpoint_provider.rb:66:in `each&#x27;
/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/endpoint_provider.rb:66:in `find&#x27;
/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/endpoint_provider.rb:66:in `partition_matching_region&#x27;
...
</code></pre><p>うーん ... なぜに nil ...</p><p>AWS_REGION を渡す</p><pre><code class="hljs language-diff"><span class="hljs-comment">diff --git a/source/study/kanazawa.rb/2016-06-18/docker-compose.yml b/source/study/kanazawa.rb/2016-06-18/docker-compose.yml</span>
<span class="hljs-comment">index e03b010..2784d3c 100644</span>
<span class="hljs-comment">--- a/source/study/kanazawa.rb/2016-06-18/docker-compose.yml</span>
<span class="hljs-comment">+++ b/source/study/kanazawa.rb/2016-06-18/docker-compose.yml</span>
<span class="hljs-meta">@@ -7,5 +7,6 @@</span> services:
     environment:
       AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
       AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
<span class="hljs-addition">+      AWS_REGION: ap-northeast-1</span>
     volumes:
       - ./scripts:/var/app/scripts</code></pre><pre><code>$ lamma create my-function --runtime python2.7

Creating function at directory ./my-function.
Done.
</code></pre><pre><code>$ tree .

my-function
  ├── lambda_function.py
  └── lamma.conf

1 directory, 2 files
</code></pre><p>まだこの時点で関数は作られていないみたい ... なんで AWS 認証求められたんだ</p><p>deploy してみる。</p><pre><code>$ lamma deploy test

Loading configuration.
Done.
bundler: failed to load command: lamma (/usr/local/bundle/bin/lamma)
Aws::Lambda::Errors::BadRequest:
/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/seahorse/client/plugins/raise_response_errors.rb:15:in `call&#x27;
/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/plugins/param_converter.rb:20:in `call&#x27;
/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/seahorse/client/plugins/response_target.rb:21:in `call&#x27;
</code></pre><p>うーん ... ?</p><p>よくわからないので JS で作り直す</p><pre><code>$ lamma create my-function-js --runtime nodejs

Creating function at directory ./my-function-js.
Done.
</code></pre><pre><code>$ lamma deploy test

Loading configuration.
Done.
Function &#x27;my-function-js&#x27; doesn&#x27;t seem to be exists.
Do you want to create new function &#x27;my-function-js&#x27; ? (y/n) y
Creating function &#x27;my-function-js&#x27; ...
bundler: failed to load command: lamma (/usr/local/bundle/bin/lamma)
Errno::ENOENT: No such file or directory @ rb_sysopen - /tmp/d20160618-92-1fppw7/lambda.zip
  /usr/local/bundle/gems/lamma-0.1.1/lib/lamma/function.rb:57:in `initialize&#x27;
...
</code></pre><p>zip ...</p><pre><code class="hljs language-diff"><span class="hljs-comment">diff --git a/source/study/kanazawa.rb/2016-06-18/Dockerfile b/source/study/kanazawa.rb/2016-06-18/Dockerfile</span>
<span class="hljs-comment">index f9e4aff..0595f36 100644</span>
<span class="hljs-comment">--- a/source/study/kanazawa.rb/2016-06-18/Dockerfile</span>
<span class="hljs-comment">+++ b/source/study/kanazawa.rb/2016-06-18/Dockerfile</span>
<span class="hljs-meta">@@ -3,3 +3,4 @@</span> FROM ruby
COPY Gemfile /var/app/Gemfile
WORKDIR /var/app
RUN bundle install
<span class="hljs-addition">+RUN apt-get update &amp;&amp; apt-get install -y zip</span></code></pre><pre><code>$ lamma deploy test

Loading configuration.
Done.
Function &#x27;my-function-js&#x27; doesn&#x27;t seem to be exists.
Do you want to create new function &#x27;my-function-js&#x27; ? (y/n) y
Creating function &#x27;my-function-js&#x27; ...
adding: lamma.conf (deflated 17%)
adding: index.js (deflated 45%)
ArgumentError occured. You might need to specify role arn you want to pass to your function via &#x27;lamma.conf&#x27; file or ENV[&#x27;AWS_LAMBDA_IAM_ROLE&#x27;].
Done.
</code></pre><p>ほむほむ ... あんましロールを書きたくないので env で</p><pre><code>export AWS_LAMBDA_IAM_ROLE=arn:aws:iam::000000000000:role/lambda_basic_execution
</code></pre><pre><code>$ lamma deploy test

Loading configuration.
Done.
Function &#x27;my-function-js&#x27; doesn&#x27;t seem to be exists.
Do you want to create new function &#x27;my-function-js&#x27; ? (y/n) y
Creating function &#x27;my-function-js&#x27; ...
adding: lamma.conf (deflated 17%)
adding: index.js (deflated 45%)
Done.
Setting aliases.
Done.
</code></pre><pre><code>$ lamma list-functions

my-function-js
</code></pre><p>できた。</p><h2>LT 感想</h2><h3>シェルチェックを使おう</h3><ul><li>文法がバラバラなので統一する</li><li>各環境でパッケージとして提供されている</li></ul><p>確かにシェルは動かすの簡単だけど、 他の環境で動かないことが多い ...</p><h3>shUnit2 を使おう</h3><ul><li>対応シェルも幅広い</li><li>ダウンロードするだけで使える！</li></ul><p>bats 派だけど、 msys でも早いなら乗り換えたいかも</p><h3>Dokku</h3><ul><li>Heroku like</li><li>前面に nginx があって、 コンテナにルーティング</li><li>heroku の build packs も利用できるので良い！</li><li>運用メンテナンスが気になるところ</li></ul><p>スケーリングしないとかで敬遠してたけども、 開発環境で利用するなら楽だよなぁ</p><p>だいぶバージョンアップされているとのことなので、触ってみたい</p><p>もっと利用されるという話なので、その話を聞いてからかな？</p><p>dokku-alt との違いもあとで調べておこう ...</p><h3>AWSSummit</h3><p>SIer が完全に淘汰されちゃう感じ</p><p>PaaS, SaaS の流行には全然触れてなかったので、 今回の話を機会に調べてみよう ...</p><h3>Iot</h3><p>書き込むのに結構ツールが必要なんですね ...</p><p>IOT 超絶敷居高い。</p></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"siteName":"My snippets","source":{"compiledSource":"var c=Object.defineProperty,d=Object.defineProperties;var u=Object.getOwnPropertyDescriptors;var s=Object.getOwnPropertySymbols;var p=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;var l=(a,n,o)=\u003en in a?c(a,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[n]=o,e=(a,n)=\u003e{for(var o in n||(n={}))p.call(n,o)\u0026\u0026l(a,o,n[o]);if(s)for(var o of s(n))t.call(n,o)\u0026\u0026l(a,o,n[o]);return a},i=(a,n)=\u003ed(a,u(n));var m=(a,n)=\u003e{var o={};for(var r in a)p.call(a,r)\u0026\u0026n.indexOf(r)\u003c0\u0026\u0026(o[r]=a[r]);if(a!=null\u0026\u0026s)for(var r of s(a))n.indexOf(r)\u003c0\u0026\u0026t.call(a,r)\u0026\u0026(o[r]=a[r]);return o};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(o){var r=o,{components:a}=r,n=m(r,[\"components\"]);return mdx(MDXLayout,i(e(e({},layoutProps),n),{components:a,mdxType:\"MDXLayout\"}),mdx(\"h2\",null,\"AWS Lambda \\u3092\\u7BA1\\u7406\\u3059\\u308B\\u30C4\\u30FC\\u30EB Lamma \\u3084\\u3063\\u3066\\u307F\\u305F\"),mdx(\"p\",null,`Ruby \\u3067\\u66F8\\u304B\\u308C\\u305F lammba \\u3068\\u3044\\u3046\\u30EA\\u30DD\\u30B8\\u30C8\\u30EA\\u304C\\u4E0A\\u304C\\u3063\\u305F\\u306E\\u3067\nruby \\u52C9\\u5F37\\u4F1A\\u306B\\u53C2\\u52A0\\u304C\\u3066\\u3089\\u89E6\\u3063\\u3066\\u307F\\u305F`),mdx(\"h3\",null,mdx(\"a\",e({parentName:\"h3\"},{href:\"https://github.com/ayemos/Lamma\"}),\"lamma\")),mdx(\"h3\",null,\"\\u4F5C\\u696D\\u30EA\\u30DD\\u30B8\\u30C8\\u30EA\"),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/mijime/mijime.github.io/tree/content/source/study/kanazawa.rb/2016-06-18\"}),\"source\")),mdx(\"h3\",null,\"\\u4F5C\\u696D\\u96D1\\u611F\"),mdx(\"p\",null,\"\\u30B7\\u30F3\\u30D7\\u30EB\\u306A Lambda \\u7BA1\\u7406\\u30C4\\u30FC\\u30EB\"),mdx(\"h4\",null,\"Pros\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"1 dir, 1 func \\u306A\\u306E\\u3067\\u308F\\u304B\\u308A\\u3084\\u3059\\u3044\\u306D\"),mdx(\"li\",{parentName:\"ul\"},\"\\u52DD\\u624B\\u306B zip \\u3057\\u3066\\u304F\\u308C\\u308B\\u306D\"),mdx(\"li\",{parentName:\"ul\"},\"Ruby \\u306A\\u306E\\u3067\\u4ECA\\u5F8C\\u62E1\\u5F35\\u3057\\u3084\\u3059\\u3044\\u3001\\u306E\\u304B\\u306A\\uFF1F\")),mdx(\"h4\",null,\"Cons\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"nodejs, python2.7 \\u306E\\u307F\\u5BFE\\u5FDC\"),mdx(\"li\",{parentName:\"ul\"},\"\\u6D88\\u3057\\u305F\\u308A\\u3059\\u308B\\u306E\\u3081\\u3093\\u3069\\u304F\\u3055\\u305D\\u3046 ... \\u307E\\u3041\\u95A2\\u6570\\u3060\\u3051\\u3060\\u304B\\u3089\\u3044\\u3044\\u3093\\u3060\\u3051\\u3069\\u3082 ...\"),mdx(\"li\",{parentName:\"ul\"},\"node_modules \\u5165\\u3063\\u3066\\u306A\\u3044\\uFF1F\")),mdx(\"h3\",null,\"\\u4F5C\\u696D\\u30ED\\u30B0\"),mdx(\"p\",null,\"\\u307E\\u305A\\u306F\\u74B0\\u5883\\u4F5C\\u6210\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-ruby\"}),\"source \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"https://rubygems.org\"'),`\n\ngem `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"lamma\"'))),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`FROM ruby\n\nCOPY Gemfile /var/app/Gemfile\nWORKDIR /var/app\nRUN bundle install\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`---\nversion: '2'\nservices:\n  app:\n    build: .\n    command: sleep 3600\n    environment:\n      AWS_ACCESS_KEY_ID: \\${AWS_ACCESS_KEY_ID}\n      AWS_SECRET_ACCESS_KEY: \\${AWS_SECRET_ACCESS_KEY}\n    volumes:\n      - ./scripts:/var/app/scripts\n`)),mdx(\"p\",null,\"\\u3068\\u308A\\u3042\\u3048\\u305A\\u30A4\\u30F3\\u30B9\\u30C8\\u30FC\\u30EB\\u3057\\u3066\\u5B9F\\u884C\\u3057\\u3066\\u307F\\u308B\"),mdx(\"p\",null,\"AWS \\u95A2\\u9023\\u306E\\u60C5\\u5831\\u3092\\u6E21\\u3057\\u3066 ...\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`eval $(cat ~/.aws/credentials | awk -v FS=\" = \" '$1~/^aws/{print \"export\",toupper($1)\"=\"$2}')\n`)),mdx(\"p\",null,\"\\u95A2\\u6570\\u3092\\u4F5C\\u6210\\u3057\\u3066\\u307F\\u308B\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`lamma create scripts/my-function-1 --runtime python2.7\n\nCreating function at directory ./scripts/my-function-1.\nbundler: failed to load command: lamma (/usr/local/bundle/bin/lamma)\nNoMethodError: undefined method \\`match' for nil:NilClass\nDid you mean?  catch\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/endpoint_provider.rb:67:in \\`block in partition_matching_region'\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/endpoint_provider.rb:66:in \\`each'\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/endpoint_provider.rb:66:in \\`find'\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/endpoint_provider.rb:66:in \\`partition_matching_region'\n...\n`)),mdx(\"p\",null,\"\\u3046\\u30FC\\u3093 ... \\u306A\\u305C\\u306B nil ...\"),mdx(\"p\",null,\"AWS_REGION \\u3092\\u6E21\\u3059\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-diff\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"diff --git a/source/study/kanazawa.rb/2016-06-18/docker-compose.yml b/source/study/kanazawa.rb/2016-06-18/docker-compose.yml\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"index e03b010..2784d3c 100644\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"--- a/source/study/kanazawa.rb/2016-06-18/docker-compose.yml\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"+++ b/source/study/kanazawa.rb/2016-06-18/docker-compose.yml\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-meta\"}),\"@@ -7,5 +7,6 @@\"),` services:\n     environment:\n       AWS_ACCESS_KEY_ID: \\${AWS_ACCESS_KEY_ID}\n       AWS_SECRET_ACCESS_KEY: \\${AWS_SECRET_ACCESS_KEY}\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-addition\"}),\"+      AWS_REGION: ap-northeast-1\"),`\n     volumes:\n       - ./scripts:/var/app/scripts`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`$ lamma create my-function --runtime python2.7\n\nCreating function at directory ./my-function.\nDone.\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`$ tree .\n\nmy-function\n  \\u251C\\u2500\\u2500 lambda_function.py\n  \\u2514\\u2500\\u2500 lamma.conf\n\n1 directory, 2 files\n`)),mdx(\"p\",null,\"\\u307E\\u3060\\u3053\\u306E\\u6642\\u70B9\\u3067\\u95A2\\u6570\\u306F\\u4F5C\\u3089\\u308C\\u3066\\u3044\\u306A\\u3044\\u307F\\u305F\\u3044 ... \\u306A\\u3093\\u3067 AWS \\u8A8D\\u8A3C\\u6C42\\u3081\\u3089\\u308C\\u305F\\u3093\\u3060\"),mdx(\"p\",null,\"deploy \\u3057\\u3066\\u307F\\u308B\\u3002\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`$ lamma deploy test\n\nLoading configuration.\nDone.\nbundler: failed to load command: lamma (/usr/local/bundle/bin/lamma)\nAws::Lambda::Errors::BadRequest:\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/seahorse/client/plugins/raise_response_errors.rb:15:in \\`call'\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/plugins/param_converter.rb:20:in \\`call'\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/seahorse/client/plugins/response_target.rb:21:in \\`call'\n`)),mdx(\"p\",null,\"\\u3046\\u30FC\\u3093 ... ?\"),mdx(\"p\",null,\"\\u3088\\u304F\\u308F\\u304B\\u3089\\u306A\\u3044\\u306E\\u3067 JS \\u3067\\u4F5C\\u308A\\u76F4\\u3059\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`$ lamma create my-function-js --runtime nodejs\n\nCreating function at directory ./my-function-js.\nDone.\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`$ lamma deploy test\n\nLoading configuration.\nDone.\nFunction 'my-function-js' doesn't seem to be exists.\nDo you want to create new function 'my-function-js' ? (y/n) y\nCreating function 'my-function-js' ...\nbundler: failed to load command: lamma (/usr/local/bundle/bin/lamma)\nErrno::ENOENT: No such file or directory @ rb_sysopen - /tmp/d20160618-92-1fppw7/lambda.zip\n  /usr/local/bundle/gems/lamma-0.1.1/lib/lamma/function.rb:57:in \\`initialize'\n...\n`)),mdx(\"p\",null,\"zip ...\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-diff\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"diff --git a/source/study/kanazawa.rb/2016-06-18/Dockerfile b/source/study/kanazawa.rb/2016-06-18/Dockerfile\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"index f9e4aff..0595f36 100644\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"--- a/source/study/kanazawa.rb/2016-06-18/Dockerfile\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"+++ b/source/study/kanazawa.rb/2016-06-18/Dockerfile\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-meta\"}),\"@@ -3,3 +3,4 @@\"),` FROM ruby\nCOPY Gemfile /var/app/Gemfile\nWORKDIR /var/app\nRUN bundle install\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-addition\"}),\"+RUN apt-get update \u0026\u0026 apt-get install -y zip\"))),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`$ lamma deploy test\n\nLoading configuration.\nDone.\nFunction 'my-function-js' doesn't seem to be exists.\nDo you want to create new function 'my-function-js' ? (y/n) y\nCreating function 'my-function-js' ...\nadding: lamma.conf (deflated 17%)\nadding: index.js (deflated 45%)\nArgumentError occured. You might need to specify role arn you want to pass to your function via 'lamma.conf' file or ENV['AWS_LAMBDA_IAM_ROLE'].\nDone.\n`)),mdx(\"p\",null,\"\\u307B\\u3080\\u307B\\u3080 ... \\u3042\\u3093\\u307E\\u3057\\u30ED\\u30FC\\u30EB\\u3092\\u66F8\\u304D\\u305F\\u304F\\u306A\\u3044\\u306E\\u3067 env \\u3067\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`export AWS_LAMBDA_IAM_ROLE=arn:aws:iam::000000000000:role/lambda_basic_execution\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`$ lamma deploy test\n\nLoading configuration.\nDone.\nFunction 'my-function-js' doesn't seem to be exists.\nDo you want to create new function 'my-function-js' ? (y/n) y\nCreating function 'my-function-js' ...\nadding: lamma.conf (deflated 17%)\nadding: index.js (deflated 45%)\nDone.\nSetting aliases.\nDone.\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`$ lamma list-functions\n\nmy-function-js\n`)),mdx(\"p\",null,\"\\u3067\\u304D\\u305F\\u3002\"),mdx(\"h2\",null,\"LT \\u611F\\u60F3\"),mdx(\"h3\",null,\"\\u30B7\\u30A7\\u30EB\\u30C1\\u30A7\\u30C3\\u30AF\\u3092\\u4F7F\\u304A\\u3046\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"\\u6587\\u6CD5\\u304C\\u30D0\\u30E9\\u30D0\\u30E9\\u306A\\u306E\\u3067\\u7D71\\u4E00\\u3059\\u308B\"),mdx(\"li\",{parentName:\"ul\"},\"\\u5404\\u74B0\\u5883\\u3067\\u30D1\\u30C3\\u30B1\\u30FC\\u30B8\\u3068\\u3057\\u3066\\u63D0\\u4F9B\\u3055\\u308C\\u3066\\u3044\\u308B\")),mdx(\"p\",null,\"\\u78BA\\u304B\\u306B\\u30B7\\u30A7\\u30EB\\u306F\\u52D5\\u304B\\u3059\\u306E\\u7C21\\u5358\\u3060\\u3051\\u3069\\u3001 \\u4ED6\\u306E\\u74B0\\u5883\\u3067\\u52D5\\u304B\\u306A\\u3044\\u3053\\u3068\\u304C\\u591A\\u3044 ...\"),mdx(\"h3\",null,\"shUnit2 \\u3092\\u4F7F\\u304A\\u3046\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"\\u5BFE\\u5FDC\\u30B7\\u30A7\\u30EB\\u3082\\u5E45\\u5E83\\u3044\"),mdx(\"li\",{parentName:\"ul\"},\"\\u30C0\\u30A6\\u30F3\\u30ED\\u30FC\\u30C9\\u3059\\u308B\\u3060\\u3051\\u3067\\u4F7F\\u3048\\u308B\\uFF01\")),mdx(\"p\",null,\"bats \\u6D3E\\u3060\\u3051\\u3069\\u3001 msys \\u3067\\u3082\\u65E9\\u3044\\u306A\\u3089\\u4E57\\u308A\\u63DB\\u3048\\u305F\\u3044\\u304B\\u3082\"),mdx(\"h3\",null,\"Dokku\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Heroku like\"),mdx(\"li\",{parentName:\"ul\"},\"\\u524D\\u9762\\u306B nginx \\u304C\\u3042\\u3063\\u3066\\u3001 \\u30B3\\u30F3\\u30C6\\u30CA\\u306B\\u30EB\\u30FC\\u30C6\\u30A3\\u30F3\\u30B0\"),mdx(\"li\",{parentName:\"ul\"},\"heroku \\u306E build packs \\u3082\\u5229\\u7528\\u3067\\u304D\\u308B\\u306E\\u3067\\u826F\\u3044\\uFF01\"),mdx(\"li\",{parentName:\"ul\"},\"\\u904B\\u7528\\u30E1\\u30F3\\u30C6\\u30CA\\u30F3\\u30B9\\u304C\\u6C17\\u306B\\u306A\\u308B\\u3068\\u3053\\u308D\")),mdx(\"p\",null,\"\\u30B9\\u30B1\\u30FC\\u30EA\\u30F3\\u30B0\\u3057\\u306A\\u3044\\u3068\\u304B\\u3067\\u656C\\u9060\\u3057\\u3066\\u305F\\u3051\\u3069\\u3082\\u3001 \\u958B\\u767A\\u74B0\\u5883\\u3067\\u5229\\u7528\\u3059\\u308B\\u306A\\u3089\\u697D\\u3060\\u3088\\u306A\\u3041\"),mdx(\"p\",null,\"\\u3060\\u3044\\u3076\\u30D0\\u30FC\\u30B8\\u30E7\\u30F3\\u30A2\\u30C3\\u30D7\\u3055\\u308C\\u3066\\u3044\\u308B\\u3068\\u306E\\u3053\\u3068\\u306A\\u306E\\u3067\\u3001\\u89E6\\u3063\\u3066\\u307F\\u305F\\u3044\"),mdx(\"p\",null,\"\\u3082\\u3063\\u3068\\u5229\\u7528\\u3055\\u308C\\u308B\\u3068\\u3044\\u3046\\u8A71\\u306A\\u306E\\u3067\\u3001\\u305D\\u306E\\u8A71\\u3092\\u805E\\u3044\\u3066\\u304B\\u3089\\u304B\\u306A\\uFF1F\"),mdx(\"p\",null,\"dokku-alt \\u3068\\u306E\\u9055\\u3044\\u3082\\u3042\\u3068\\u3067\\u8ABF\\u3079\\u3066\\u304A\\u3053\\u3046 ...\"),mdx(\"h3\",null,\"AWSSummit\"),mdx(\"p\",null,\"SIer \\u304C\\u5B8C\\u5168\\u306B\\u6DD8\\u6C70\\u3055\\u308C\\u3061\\u3083\\u3046\\u611F\\u3058\"),mdx(\"p\",null,\"PaaS, SaaS \\u306E\\u6D41\\u884C\\u306B\\u306F\\u5168\\u7136\\u89E6\\u308C\\u3066\\u306A\\u304B\\u3063\\u305F\\u306E\\u3067\\u3001 \\u4ECA\\u56DE\\u306E\\u8A71\\u3092\\u6A5F\\u4F1A\\u306B\\u8ABF\\u3079\\u3066\\u307F\\u3088\\u3046 ...\"),mdx(\"h3\",null,\"Iot\"),mdx(\"p\",null,\"\\u66F8\\u304D\\u8FBC\\u3080\\u306E\\u306B\\u7D50\\u69CB\\u30C4\\u30FC\\u30EB\\u304C\\u5FC5\\u8981\\u306A\\u3093\\u3067\\u3059\\u306D ...\"),mdx(\"p\",null,\"IOT \\u8D85\\u7D76\\u6577\\u5C45\\u9AD8\\u3044\\u3002\"))}MDXContent.isMDXComponent=!0;\n","scope":{}},"post":{"title":" kanazawa.rb meetup 46に参加した","description":"\n## AWS Lambda を管理するツール Lamma やってみた\n\nRuby で書かれた lammba というリポジトリが上がったので\nruby 勉強会に参加がてら触ってみた\n\n### [lam","createdAt":"2016-06-18T04:23:05.000Z","tags":["development","lambda","kzrb"],"draft":false,"slug":"study/kanazawa.rb/2016/06/18","content":"\n## AWS Lambda を管理するツール Lamma やってみた\n\nRuby で書かれた lammba というリポジトリが上がったので\nruby 勉強会に参加がてら触ってみた\n\n### [lamma](https://github.com/ayemos/Lamma)\n\n### 作業リポジトリ\n\n[source](https://github.com/mijime/mijime.github.io/tree/content/source/study/kanazawa.rb/2016-06-18)\n\n### 作業雑感\n\nシンプルな Lambda 管理ツール\n\n#### Pros\n\n- 1 dir, 1 func なのでわかりやすいね\n- 勝手に zip してくれるね\n- Ruby なので今後拡張しやすい、のかな？\n\n#### Cons\n\n- nodejs, python2.7 のみ対応\n- 消したりするのめんどくさそう ... まぁ関数だけだからいいんだけども ...\n- node_modules 入ってない？\n\n### 作業ログ\n\nまずは環境作成\n\n```ruby\nsource \"https://rubygems.org\"\n\ngem \"lamma\"\n```\n\n```\nFROM ruby\n\nCOPY Gemfile /var/app/Gemfile\nWORKDIR /var/app\nRUN bundle install\n```\n\n```\n---\nversion: '2'\nservices:\n  app:\n    build: .\n    command: sleep 3600\n    environment:\n      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}\n      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}\n    volumes:\n      - ./scripts:/var/app/scripts\n```\n\nとりあえずインストールして実行してみる\n\nAWS 関連の情報を渡して ...\n\n```\neval $(cat ~/.aws/credentials | awk -v FS=\" = \" '$1~/^aws/{print \"export\",toupper($1)\"=\"$2}')\n```\n\n関数を作成してみる\n\n```\nlamma create scripts/my-function-1 --runtime python2.7\n\nCreating function at directory ./scripts/my-function-1.\nbundler: failed to load command: lamma (/usr/local/bundle/bin/lamma)\nNoMethodError: undefined method `match' for nil:NilClass\nDid you mean?  catch\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/endpoint_provider.rb:67:in `block in partition_matching_region'\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/endpoint_provider.rb:66:in `each'\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/endpoint_provider.rb:66:in `find'\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/endpoint_provider.rb:66:in `partition_matching_region'\n...\n```\n\nうーん ... なぜに nil ...\n\nAWS_REGION を渡す\n\n```diff\ndiff --git a/source/study/kanazawa.rb/2016-06-18/docker-compose.yml b/source/study/kanazawa.rb/2016-06-18/docker-compose.yml\nindex e03b010..2784d3c 100644\n--- a/source/study/kanazawa.rb/2016-06-18/docker-compose.yml\n+++ b/source/study/kanazawa.rb/2016-06-18/docker-compose.yml\n@@ -7,5 +7,6 @@ services:\n     environment:\n       AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}\n       AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}\n+      AWS_REGION: ap-northeast-1\n     volumes:\n       - ./scripts:/var/app/scripts\n```\n\n```\n$ lamma create my-function --runtime python2.7\n\nCreating function at directory ./my-function.\nDone.\n```\n\n```\n$ tree .\n\nmy-function\n  ├── lambda_function.py\n  └── lamma.conf\n\n1 directory, 2 files\n```\n\nまだこの時点で関数は作られていないみたい ... なんで AWS 認証求められたんだ\n\ndeploy してみる。\n\n```\n$ lamma deploy test\n\nLoading configuration.\nDone.\nbundler: failed to load command: lamma (/usr/local/bundle/bin/lamma)\nAws::Lambda::Errors::BadRequest:\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/seahorse/client/plugins/raise_response_errors.rb:15:in `call'\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/aws-sdk-core/plugins/param_converter.rb:20:in `call'\n/usr/local/bundle/gems/aws-sdk-core-2.3.14/lib/seahorse/client/plugins/response_target.rb:21:in `call'\n```\n\nうーん ... ?\n\nよくわからないので JS で作り直す\n\n```\n$ lamma create my-function-js --runtime nodejs\n\nCreating function at directory ./my-function-js.\nDone.\n```\n\n```\n$ lamma deploy test\n\nLoading configuration.\nDone.\nFunction 'my-function-js' doesn't seem to be exists.\nDo you want to create new function 'my-function-js' ? (y/n) y\nCreating function 'my-function-js' ...\nbundler: failed to load command: lamma (/usr/local/bundle/bin/lamma)\nErrno::ENOENT: No such file or directory @ rb_sysopen - /tmp/d20160618-92-1fppw7/lambda.zip\n  /usr/local/bundle/gems/lamma-0.1.1/lib/lamma/function.rb:57:in `initialize'\n...\n```\n\nzip ...\n\n```diff\ndiff --git a/source/study/kanazawa.rb/2016-06-18/Dockerfile b/source/study/kanazawa.rb/2016-06-18/Dockerfile\nindex f9e4aff..0595f36 100644\n--- a/source/study/kanazawa.rb/2016-06-18/Dockerfile\n+++ b/source/study/kanazawa.rb/2016-06-18/Dockerfile\n@@ -3,3 +3,4 @@ FROM ruby\nCOPY Gemfile /var/app/Gemfile\nWORKDIR /var/app\nRUN bundle install\n+RUN apt-get update \u0026\u0026 apt-get install -y zip\n```\n\n```\n$ lamma deploy test\n\nLoading configuration.\nDone.\nFunction 'my-function-js' doesn't seem to be exists.\nDo you want to create new function 'my-function-js' ? (y/n) y\nCreating function 'my-function-js' ...\nadding: lamma.conf (deflated 17%)\nadding: index.js (deflated 45%)\nArgumentError occured. You might need to specify role arn you want to pass to your function via 'lamma.conf' file or ENV['AWS_LAMBDA_IAM_ROLE'].\nDone.\n```\n\nほむほむ ... あんましロールを書きたくないので env で\n\n```\nexport AWS_LAMBDA_IAM_ROLE=arn:aws:iam::000000000000:role/lambda_basic_execution\n```\n\n```\n$ lamma deploy test\n\nLoading configuration.\nDone.\nFunction 'my-function-js' doesn't seem to be exists.\nDo you want to create new function 'my-function-js' ? (y/n) y\nCreating function 'my-function-js' ...\nadding: lamma.conf (deflated 17%)\nadding: index.js (deflated 45%)\nDone.\nSetting aliases.\nDone.\n```\n\n```\n$ lamma list-functions\n\nmy-function-js\n```\n\nできた。\n\n## LT 感想\n\n### シェルチェックを使おう\n\n- 文法がバラバラなので統一する\n- 各環境でパッケージとして提供されている\n\n確かにシェルは動かすの簡単だけど、 他の環境で動かないことが多い ...\n\n### shUnit2 を使おう\n\n- 対応シェルも幅広い\n- ダウンロードするだけで使える！\n\nbats 派だけど、 msys でも早いなら乗り換えたいかも\n\n### Dokku\n\n- Heroku like\n- 前面に nginx があって、 コンテナにルーティング\n- heroku の build packs も利用できるので良い！\n- 運用メンテナンスが気になるところ\n\nスケーリングしないとかで敬遠してたけども、 開発環境で利用するなら楽だよなぁ\n\nだいぶバージョンアップされているとのことなので、触ってみたい\n\nもっと利用されるという話なので、その話を聞いてからかな？\n\ndokku-alt との違いもあとで調べておこう ...\n\n### AWSSummit\n\nSIer が完全に淘汰されちゃう感じ\n\nPaaS, SaaS の流行には全然触れてなかったので、 今回の話を機会に調べてみよう ...\n\n### Iot\n\n書き込むのに結構ツールが必要なんですね ...\n\nIOT 超絶敷居高い。\n"}},"__N_SSG":true},"page":"/post/[...paths]","query":{"paths":["study","kanazawa.rb","2016","06","18"]},"buildId":"1cM0zPcXCmvgNJ12n612E","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>