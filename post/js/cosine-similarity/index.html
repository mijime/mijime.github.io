<!DOCTYPE html><html lang="ja"><head><link rel="icon" href="/favicon.png"/><meta name="google-site-verification" content="7gVj5rzyozu0vYcQMLhIGr4g-WWyJn4R22RgeYqQdS0"/><script src="https://www.googletagmanager.com/gtag/js?id=UA-46554348-4"></script><script>
window.dataLayer = window.dataLayer || [];
window.gtag = function(){dataLayer.push(arguments);}
window.gtag('js', new Date());
window.gtag('config', 'UA-46554348-4', {page_path: window.location.pathname});
</script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>関連記事を探す | My snippets</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/3118f4a5cdc48aa468ba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3118f4a5cdc48aa468ba.css" data-n-g=""/><link rel="preload" href="/_next/static/css/be10f5f7efdee9258153.css" as="style"/><link rel="stylesheet" href="/_next/static/css/be10f5f7efdee9258153.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-377d9957422d331503bc.js" defer=""></script><script src="/_next/static/chunks/framework-92300432a1172ef1338b.js" defer=""></script><script src="/_next/static/chunks/main-ff11dfa7b9d2932d51f3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-aeb6e3be34fe6d240b38.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5B...paths%5D-9248b9a62a3194e493a0.js" defer=""></script><script src="/_next/static/1cM0zPcXCmvgNJ12n612E/_buildManifest.js" defer=""></script><script src="/_next/static/1cM0zPcXCmvgNJ12n612E/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="default_defaultLayout__1hsFy"><section class="navbar-header_navbarHeader__3g5tB"><h3 class="navbar-header_navbarHeaderTitle__2ef7R"><a href="/">My snippets</a></h3></section><div class="default_defaultLayoutContent__2tmRG"><div class="card_card__DcOjB"><h1 class="article-card_title__3J6E6"><a href="/post/js/cosine-similarity/">関連記事を探す</a></h1><div class="tag-list_tagList__2paiH"><span class="tag_tag__Z47f9 tag-list_tagLink__ESpk3"><a href="/tag/development/posts/1/">development</a></span><span class="tag_tag__Z47f9 tag-list_tagLink__ESpk3"><a href="/tag/javascript/posts/1/">javascript</a></span><span class="tag_tag__Z47f9 tag-list_tagDate__2WCFH">5 years ago</span></div><div class="article-card_content__3af8_"><div class="prose prose_prose__2WXno"><p>他のブログを参考にすると関連記事というのを最後に表示しているらしい。</p><p>まだ記事の数は少ないけど、ある程度近い記事を探すことができるようにする。</p><h3>類似度の取得</h3><p>&quot;MeCab&quot; + &quot;類似&quot; でググったら、コサイン類似度なるものがあるとのこと。</p><ul><li><a href="http://www.cse.kyoto-su.ac.jp/~g0846020/keywords/cosinSimilarity.html">コサイン類似度</a></li><li><a href="http://qiita.com/nmbakfm/items/6bb91b89571dd68fcea6">TF-IDF Cos 類似度推定法</a></li></ul><p>このブログは js + hugo で書いているので、
<a href="https://www.npmjs.com/package/kuromoji">kuromoji</a> のラッパー
<a href="https://www.npmjs.com/package/kuromojin">kuromojin</a> を使って形態素解析する。</p><h3>コード解説</h3><p><a href="https://github.com/mijime/mijime.github.io/blob/content/source/js/similarity/index.js">コード全体</a></p><p>テキストを分解して、 単語と出現回数を記録する。</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseVector</span>(<span class="hljs-params">text</span>) </span>{
  <span class="hljs-keyword">const</span> tokens = <span class="hljs-keyword">await</span> tokenize(text)
  <span class="hljs-keyword">return</span> tokens.reduce(<span class="hljs-function">(<span class="hljs-params">acc, next</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!isTargetToken(next)) {
      <span class="hljs-keyword">return</span> acc
    }

    <span class="hljs-keyword">if</span> (acc[next.surface_form]) {
      acc[next.surface_form]++
    } <span class="hljs-keyword">else</span> {
      acc[next.surface_form] = <span class="hljs-number">1</span>
    }

    <span class="hljs-keyword">return</span> acc
  }, {})
}</code></pre><p>出現回数を数えるのは名詞で 3 文字以上の単語のみ。</p><pre><code class="hljs language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isTargetToken</span>(<span class="hljs-params">token</span>) </span>{
  <span class="hljs-keyword">return</span> (
    token.pos === <span class="hljs-string">&#x27;名詞&#x27;</span> &amp;&amp;
    token.surface_form.length &gt;= <span class="hljs-number">3</span> &amp;&amp;
    (token.basic_form !== <span class="hljs-string">&#x27;*&#x27;</span> || token.surface_form.match(<span class="hljs-regexp">/^[\wA-Z]+$/</span>))
  )
}</code></pre><p>あとは計算しておしまい。</p><pre><code class="hljs language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cosineSimilarity</span>(<span class="hljs-params">curr, next</span>) </span>{
  <span class="hljs-keyword">const</span> currKeys = <span class="hljs-built_in">Object</span>.keys(curr)
  <span class="hljs-keyword">const</span> nextKeys = <span class="hljs-built_in">Object</span>.keys(next)
  <span class="hljs-keyword">const</span> keys = currKeys
    .concat(nextKeys)
    .filter(<span class="hljs-function">(<span class="hljs-params">v, i, self</span>) =&gt;</span> self.indexOf(v) === i)

  <span class="hljs-keyword">const</span> baseScore = keys
    .map(<span class="hljs-function"><span class="hljs-params">k</span> =&gt;</span> (curr[k] || <span class="hljs-number">0</span>) * (next[k] || <span class="hljs-number">0</span>))
    .reduce(<span class="hljs-function">(<span class="hljs-params">acc, c</span>) =&gt;</span> acc + c, <span class="hljs-number">0</span>)

  <span class="hljs-keyword">const</span> currScore = keys
    .map(<span class="hljs-function"><span class="hljs-params">k</span> =&gt;</span> (curr[k] ? <span class="hljs-built_in">Math</span>.pow(curr[k], <span class="hljs-number">2</span>) : <span class="hljs-number">0</span>))
    .reduce(<span class="hljs-function">(<span class="hljs-params">acc, c</span>) =&gt;</span> acc + c, <span class="hljs-number">0</span>)

  <span class="hljs-keyword">const</span> nextScore = keys
    .map(<span class="hljs-function"><span class="hljs-params">k</span> =&gt;</span> (next[k] ? <span class="hljs-built_in">Math</span>.pow(next[k], <span class="hljs-number">2</span>) : <span class="hljs-number">0</span>))
    .reduce(<span class="hljs-function">(<span class="hljs-params">acc, c</span>) =&gt;</span> acc + c, <span class="hljs-number">0</span>)

  <span class="hljs-keyword">const</span> score = baseScore
    ? baseScore / (<span class="hljs-built_in">Math</span>.sqrt(currScore) * <span class="hljs-built_in">Math</span>.sqrt(nextScore))
    : <span class="hljs-number">0</span>
  <span class="hljs-keyword">const</span> words = keys.filter(<span class="hljs-function"><span class="hljs-params">k</span> =&gt;</span> curr[k] &amp;&amp; next[k])
  <span class="hljs-keyword">return</span> { score, words }
}</code></pre><h3>実行結果</h3><p>うーん、全然関係ない単語でしか一致しない。その通りではあるんだけど。</p><pre><code>babel-node source/js/similarity &quot;content/posts/js/cosine-similarity.md&quot; &quot;content&quot;

25.26%  content\posts\2016-05-23\github-cli.md  com, https, mijime, github
0%      content\posts\2016-05-26\border-implement.md
0%      content\posts\2016-05-26\ci-is-difficult.md
0%      content\posts\blog\first-blogged.md
0%      content\posts\hugo\code-mermaid.md
20.9%   content\posts\hugo\hugo-deploy.md       branch, content
100%    content\posts\js\cosine-similarity.md   100, 2016, 89571, MeCab, コサイン
9.93%   content\posts\blog\blog-of-policy.md    branch, posts, slides
1.98%   content\posts\hugo\hugo-pagination.md   html, pagination
3.52%   content\slides\2016-05-27\my-first-slide.md     html
</code></pre></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"siteName":"My snippets","source":{"compiledSource":"var N=Object.defineProperty,d=Object.defineProperties;var i=Object.getOwnPropertyDescriptors;var c=Object.getOwnPropertySymbols;var t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;var m=(s,e,n)=\u003ee in s?N(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,a=(s,e)=\u003e{for(var n in e||(e={}))t.call(e,n)\u0026\u0026m(s,n,e[n]);if(c)for(var n of c(e))r.call(e,n)\u0026\u0026m(s,n,e[n]);return s},o=(s,e)=\u003ed(s,i(e));var l=(s,e)=\u003e{var n={};for(var p in s)t.call(s,p)\u0026\u0026e.indexOf(p)\u003c0\u0026\u0026(n[p]=s[p]);if(s!=null\u0026\u0026c)for(var p of c(s))e.indexOf(p)\u003c0\u0026\u0026r.call(s,p)\u0026\u0026(n[p]=s[p]);return n};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var p=n,{components:s}=p,e=l(p,[\"components\"]);return mdx(MDXLayout,o(a(a({},layoutProps),e),{components:s,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"\\u4ED6\\u306E\\u30D6\\u30ED\\u30B0\\u3092\\u53C2\\u8003\\u306B\\u3059\\u308B\\u3068\\u95A2\\u9023\\u8A18\\u4E8B\\u3068\\u3044\\u3046\\u306E\\u3092\\u6700\\u5F8C\\u306B\\u8868\\u793A\\u3057\\u3066\\u3044\\u308B\\u3089\\u3057\\u3044\\u3002\"),mdx(\"p\",null,\"\\u307E\\u3060\\u8A18\\u4E8B\\u306E\\u6570\\u306F\\u5C11\\u306A\\u3044\\u3051\\u3069\\u3001\\u3042\\u308B\\u7A0B\\u5EA6\\u8FD1\\u3044\\u8A18\\u4E8B\\u3092\\u63A2\\u3059\\u3053\\u3068\\u304C\\u3067\\u304D\\u308B\\u3088\\u3046\\u306B\\u3059\\u308B\\u3002\"),mdx(\"h3\",null,\"\\u985E\\u4F3C\\u5EA6\\u306E\\u53D6\\u5F97\"),mdx(\"p\",null,'\"MeCab\" + \"\\u985E\\u4F3C\" \\u3067\\u30B0\\u30B0\\u3063\\u305F\\u3089\\u3001\\u30B3\\u30B5\\u30A4\\u30F3\\u985E\\u4F3C\\u5EA6\\u306A\\u308B\\u3082\\u306E\\u304C\\u3042\\u308B\\u3068\\u306E\\u3053\\u3068\\u3002'),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",a({parentName:\"li\"},{href:\"http://www.cse.kyoto-su.ac.jp/~g0846020/keywords/cosinSimilarity.html\"}),\"\\u30B3\\u30B5\\u30A4\\u30F3\\u985E\\u4F3C\\u5EA6\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",a({parentName:\"li\"},{href:\"http://qiita.com/nmbakfm/items/6bb91b89571dd68fcea6\"}),\"TF-IDF Cos \\u985E\\u4F3C\\u5EA6\\u63A8\\u5B9A\\u6CD5\"))),mdx(\"p\",null,`\\u3053\\u306E\\u30D6\\u30ED\\u30B0\\u306F js + hugo \\u3067\\u66F8\\u3044\\u3066\\u3044\\u308B\\u306E\\u3067\\u3001\n`,mdx(\"a\",a({parentName:\"p\"},{href:\"https://www.npmjs.com/package/kuromoji\"}),\"kuromoji\"),` \\u306E\\u30E9\\u30C3\\u30D1\\u30FC\n`,mdx(\"a\",a({parentName:\"p\"},{href:\"https://www.npmjs.com/package/kuromojin\"}),\"kuromojin\"),\" \\u3092\\u4F7F\\u3063\\u3066\\u5F62\\u614B\\u7D20\\u89E3\\u6790\\u3059\\u308B\\u3002\"),mdx(\"h3\",null,\"\\u30B3\\u30FC\\u30C9\\u89E3\\u8AAC\"),mdx(\"p\",null,mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/mijime/mijime.github.io/blob/content/source/js/similarity/index.js\"}),\"\\u30B3\\u30FC\\u30C9\\u5168\\u4F53\")),mdx(\"p\",null,\"\\u30C6\\u30AD\\u30B9\\u30C8\\u3092\\u5206\\u89E3\\u3057\\u3066\\u3001 \\u5358\\u8A9E\\u3068\\u51FA\\u73FE\\u56DE\\u6570\\u3092\\u8A18\\u9332\\u3059\\u308B\\u3002\"),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{className:\"hljs language-javascript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"async\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-keyword\"}),\"function\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-title\"}),\"parseVector\"),\"(\",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"text\"),\") \"),`{\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" tokens = \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"await\"),` tokenize(text)\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),\" tokens.reduce(\",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),\"(\",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"acc, next\"),\") =\u003e\"),` {\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),` (!isTargetToken(next)) {\n      `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` acc\n    }\n\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),` (acc[next.surface_form]) {\n      acc[next.surface_form]++\n    } `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"else\"),` {\n      acc[next.surface_form] = `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-number\"}),\"1\"),`\n    }\n\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` acc\n  }, {})\n}`)),mdx(\"p\",null,\"\\u51FA\\u73FE\\u56DE\\u6570\\u3092\\u6570\\u3048\\u308B\\u306E\\u306F\\u540D\\u8A5E\\u3067 3 \\u6587\\u5B57\\u4EE5\\u4E0A\\u306E\\u5358\\u8A9E\\u306E\\u307F\\u3002\"),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{className:\"hljs language-javascript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-keyword\"}),\"function\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-title\"}),\"isTargetToken\"),\"(\",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"token\"),\") \"),`{\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` (\n    token.pos === `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-string\"}),\"'\\u540D\\u8A5E'\"),` \u0026\u0026\n    token.surface_form.length \u003e= `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-number\"}),\"3\"),` \u0026\u0026\n    (token.basic_form !== `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-string\"}),\"'*'\"),\" || token.surface_form.match(\",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-regexp\"}),\"/^[\\\\wA-Z]+$/\"),`))\n  )\n}`)),mdx(\"p\",null,\"\\u3042\\u3068\\u306F\\u8A08\\u7B97\\u3057\\u3066\\u304A\\u3057\\u307E\\u3044\\u3002\"),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{className:\"hljs language-javascript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-keyword\"}),\"function\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-title\"}),\"cosineSimilarity\"),\"(\",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"curr, next\"),\") \"),`{\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" currKeys = \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-built_in\"}),\"Object\"),`.keys(curr)\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" nextKeys = \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-built_in\"}),\"Object\"),`.keys(next)\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),` keys = currKeys\n    .concat(nextKeys)\n    .filter(`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),\"(\",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"v, i, self\"),\") =\u003e\"),` self.indexOf(v) === i)\n\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),` baseScore = keys\n    .map(`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"k\"),\" =\u003e\"),\" (curr[k] || \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-number\"}),\"0\"),\") * (next[k] || \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-number\"}),\"0\"),`))\n    .reduce(`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),\"(\",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"acc, c\"),\") =\u003e\"),\" acc + c, \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-number\"}),\"0\"),`)\n\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),` currScore = keys\n    .map(`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"k\"),\" =\u003e\"),\" (curr[k] ? \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-built_in\"}),\"Math\"),\".pow(curr[k], \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-number\"}),\"2\"),\") : \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-number\"}),\"0\"),`))\n    .reduce(`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),\"(\",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"acc, c\"),\") =\u003e\"),\" acc + c, \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-number\"}),\"0\"),`)\n\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),` nextScore = keys\n    .map(`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"k\"),\" =\u003e\"),\" (next[k] ? \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-built_in\"}),\"Math\"),\".pow(next[k], \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-number\"}),\"2\"),\") : \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-number\"}),\"0\"),`))\n    .reduce(`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),\"(\",mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"acc, c\"),\") =\u003e\"),\" acc + c, \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-number\"}),\"0\"),`)\n\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),` score = baseScore\n    ? baseScore / (`,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-built_in\"}),\"Math\"),\".sqrt(currScore) * \",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-built_in\"}),\"Math\"),`.sqrt(nextScore))\n    : `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-number\"}),\"0\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" words = keys.filter(\",mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"hljs-params\"}),\"k\"),\" =\u003e\"),` curr[k] \u0026\u0026 next[k])\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` { score, words }\n}`)),mdx(\"h3\",null,\"\\u5B9F\\u884C\\u7D50\\u679C\"),mdx(\"p\",null,\"\\u3046\\u30FC\\u3093\\u3001\\u5168\\u7136\\u95A2\\u4FC2\\u306A\\u3044\\u5358\\u8A9E\\u3067\\u3057\\u304B\\u4E00\\u81F4\\u3057\\u306A\\u3044\\u3002\\u305D\\u306E\\u901A\\u308A\\u3067\\u306F\\u3042\\u308B\\u3093\\u3060\\u3051\\u3069\\u3002\"),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{}),`babel-node source/js/similarity \"content/posts/js/cosine-similarity.md\" \"content\"\n\n25.26%  content\\\\posts\\\\2016-05-23\\\\github-cli.md  com, https, mijime, github\n0%      content\\\\posts\\\\2016-05-26\\\\border-implement.md\n0%      content\\\\posts\\\\2016-05-26\\\\ci-is-difficult.md\n0%      content\\\\posts\\\\blog\\\\first-blogged.md\n0%      content\\\\posts\\\\hugo\\\\code-mermaid.md\n20.9%   content\\\\posts\\\\hugo\\\\hugo-deploy.md       branch, content\n100%    content\\\\posts\\\\js\\\\cosine-similarity.md   100, 2016, 89571, MeCab, \\u30B3\\u30B5\\u30A4\\u30F3\n9.93%   content\\\\posts\\\\blog\\\\blog-of-policy.md    branch, posts, slides\n1.98%   content\\\\posts\\\\hugo\\\\hugo-pagination.md   html, pagination\n3.52%   content\\\\slides\\\\2016-05-27\\\\my-first-slide.md     html\n`)))}MDXContent.isMDXComponent=!0;\n","scope":{}},"post":{"title":"関連記事を探す","description":"\n他のブログを参考にすると関連記事というのを最後に表示しているらしい。\n\nまだ記事の数は少ないけど、ある程度近い記事を探すことができるようにする。\n\n### 類似度の取得\n\n\"MeCab\" + \"類似","createdAt":"2016-05-28T12:12:36.000Z","tags":["development","javascript"],"draft":false,"slug":"js/cosine-similarity","content":"\n他のブログを参考にすると関連記事というのを最後に表示しているらしい。\n\nまだ記事の数は少ないけど、ある程度近い記事を探すことができるようにする。\n\n### 類似度の取得\n\n\"MeCab\" + \"類似\" でググったら、コサイン類似度なるものがあるとのこと。\n\n- [コサイン類似度](http://www.cse.kyoto-su.ac.jp/~g0846020/keywords/cosinSimilarity.html)\n- [TF-IDF Cos 類似度推定法](http://qiita.com/nmbakfm/items/6bb91b89571dd68fcea6)\n\nこのブログは js + hugo で書いているので、\n[kuromoji](https://www.npmjs.com/package/kuromoji) のラッパー\n[kuromojin](https://www.npmjs.com/package/kuromojin) を使って形態素解析する。\n\n### コード解説\n\n[コード全体](https://github.com/mijime/mijime.github.io/blob/content/source/js/similarity/index.js)\n\nテキストを分解して、 単語と出現回数を記録する。\n\n```javascript\nasync function parseVector(text) {\n  const tokens = await tokenize(text)\n  return tokens.reduce((acc, next) =\u003e {\n    if (!isTargetToken(next)) {\n      return acc\n    }\n\n    if (acc[next.surface_form]) {\n      acc[next.surface_form]++\n    } else {\n      acc[next.surface_form] = 1\n    }\n\n    return acc\n  }, {})\n}\n```\n\n出現回数を数えるのは名詞で 3 文字以上の単語のみ。\n\n```javascript\nfunction isTargetToken(token) {\n  return (\n    token.pos === '名詞' \u0026\u0026\n    token.surface_form.length \u003e= 3 \u0026\u0026\n    (token.basic_form !== '*' || token.surface_form.match(/^[\\wA-Z]+$/))\n  )\n}\n```\n\nあとは計算しておしまい。\n\n```javascript\nfunction cosineSimilarity(curr, next) {\n  const currKeys = Object.keys(curr)\n  const nextKeys = Object.keys(next)\n  const keys = currKeys\n    .concat(nextKeys)\n    .filter((v, i, self) =\u003e self.indexOf(v) === i)\n\n  const baseScore = keys\n    .map(k =\u003e (curr[k] || 0) * (next[k] || 0))\n    .reduce((acc, c) =\u003e acc + c, 0)\n\n  const currScore = keys\n    .map(k =\u003e (curr[k] ? Math.pow(curr[k], 2) : 0))\n    .reduce((acc, c) =\u003e acc + c, 0)\n\n  const nextScore = keys\n    .map(k =\u003e (next[k] ? Math.pow(next[k], 2) : 0))\n    .reduce((acc, c) =\u003e acc + c, 0)\n\n  const score = baseScore\n    ? baseScore / (Math.sqrt(currScore) * Math.sqrt(nextScore))\n    : 0\n  const words = keys.filter(k =\u003e curr[k] \u0026\u0026 next[k])\n  return { score, words }\n}\n```\n\n### 実行結果\n\nうーん、全然関係ない単語でしか一致しない。その通りではあるんだけど。\n\n```\nbabel-node source/js/similarity \"content/posts/js/cosine-similarity.md\" \"content\"\n\n25.26%  content\\posts\\2016-05-23\\github-cli.md  com, https, mijime, github\n0%      content\\posts\\2016-05-26\\border-implement.md\n0%      content\\posts\\2016-05-26\\ci-is-difficult.md\n0%      content\\posts\\blog\\first-blogged.md\n0%      content\\posts\\hugo\\code-mermaid.md\n20.9%   content\\posts\\hugo\\hugo-deploy.md       branch, content\n100%    content\\posts\\js\\cosine-similarity.md   100, 2016, 89571, MeCab, コサイン\n9.93%   content\\posts\\blog\\blog-of-policy.md    branch, posts, slides\n1.98%   content\\posts\\hugo\\hugo-pagination.md   html, pagination\n3.52%   content\\slides\\2016-05-27\\my-first-slide.md     html\n```\n"}},"__N_SSG":true},"page":"/post/[...paths]","query":{"paths":["js","cosine-similarity"]},"buildId":"1cM0zPcXCmvgNJ12n612E","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>