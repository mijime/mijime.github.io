<!DOCTYPE html><html lang="ja"><head><link rel="icon" href="/favicon.png"/><meta name="google-site-verification" content="7gVj5rzyozu0vYcQMLhIGr4g-WWyJn4R22RgeYqQdS0"/><script src="https://www.googletagmanager.com/gtag/js?id=UA-46554348-4"></script><script>
window.dataLayer = window.dataLayer || [];
window.gtag = function(){dataLayer.push(arguments);}
window.gtag('js', new Date());
window.gtag('config', 'UA-46554348-4', {page_path: window.location.pathname});
</script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>関連記事を探す | My snippets</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/441a871f60534772bea2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/441a871f60534772bea2.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cea597752152cbfd5de4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cea597752152cbfd5de4.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-68ca09d5e091eab3c5ab.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.d2ae4074d0a54d95f68e.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.7394d07e57118caf40be.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-9ecc240cedbde30f7a8f.js" as="script"/><link rel="preload" href="/_next/static/chunks/8d28131037b551229a39f010c44923deddaa105c.d6b252b26e2153b31569.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/post/js/cosine-similarity-0da4025866b8366b6686.js" as="script"/></head><body><div id="__next"><div class="default_defaultLayoutContent__1-Dol"><section class="navbar-header_navbarHeader__2QEfN"><h3 class="navbar-header_navbarHeaderTitle__ucqZ4"><a href="/">My snippets</a></h3></section><div class="default_defaultLayoutContent__1-Dol"><div class="card_card__23baz"><h1 class="article-card_title__2q2Ue"><a href="/post/js/cosine-similarity/">関連記事を探す</a></h1><div class="tag-list_tagList__JhjSf"><span class="tag_tag__35zkz tag-list_tagLink__1TsNW"><a href="/tag/development/posts/1/">development</a></span><span class="tag_tag__35zkz tag-list_tagLink__1TsNW"><a href="/tag/javascript/posts/1/">javascript</a></span><span class="tag_tag__35zkz tag-list_tagDate__x9jrl">4 years ago</span></div><div class="article-card_content__pMn5H"><div class="prose post_prose__31ydD"><p>他のブログを参考にすると関連記事というのを最後に表示しているらしい。</p><p>まだ記事の数は少ないけど、ある程度近い記事を探すことができるようにする。</p><h3>類似度の取得</h3><p>&quot;MeCab&quot; + &quot;類似&quot; でググったら、コサイン類似度なるものがあるとのこと。</p><ul><li><a href="http://www.cse.kyoto-su.ac.jp/~g0846020/keywords/cosinSimilarity.html">コサイン類似度</a></li><li><a href="http://qiita.com/nmbakfm/items/6bb91b89571dd68fcea6">TF-IDF Cos 類似度推定法</a></li></ul><p>このブログは js + hugo で書いているので、
<a href="https://www.npmjs.com/package/kuromoji">kuromoji</a> のラッパー
<a href="https://www.npmjs.com/package/kuromojin">kuromojin</a> を使って形態素解析する。</p><h3>コード解説</h3><p><a href="https://github.com/mijime/mijime.github.io/blob/content/source/js/similarity/index.js">コード全体</a></p><p>テキストを分解して、 単語と出現回数を記録する。</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseVector</span>(<span class="hljs-params">text</span>) </span>{
  <span class="hljs-keyword">const</span> tokens = <span class="hljs-keyword">await</span> tokenize(text)
  <span class="hljs-keyword">return</span> tokens.reduce(<span class="hljs-function">(<span class="hljs-params">acc, next</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!isTargetToken(next)) {
      <span class="hljs-keyword">return</span> acc
    }

    <span class="hljs-keyword">if</span> (acc[next.surface_form]) {
      acc[next.surface_form]++
    } <span class="hljs-keyword">else</span> {
      acc[next.surface_form] = <span class="hljs-number">1</span>
    }

    <span class="hljs-keyword">return</span> acc
  }, {})
}</code></pre><p>出現回数を数えるのは名詞で 3 文字以上の単語のみ。</p><pre><code class="hljs language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isTargetToken</span>(<span class="hljs-params">token</span>) </span>{
  <span class="hljs-keyword">return</span> (
    token.pos === <span class="hljs-string">&#x27;名詞&#x27;</span> &amp;&amp;
    token.surface_form.length &gt;= <span class="hljs-number">3</span> &amp;&amp;
    (token.basic_form !== <span class="hljs-string">&#x27;*&#x27;</span> || token.surface_form.match(<span class="hljs-regexp">/^[\wA-Z]+$/</span>))
  )
}</code></pre><p>あとは計算しておしまい。</p><pre><code class="hljs language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cosineSimilarity</span>(<span class="hljs-params">curr, next</span>) </span>{
  <span class="hljs-keyword">const</span> currKeys = <span class="hljs-built_in">Object</span>.keys(curr)
  <span class="hljs-keyword">const</span> nextKeys = <span class="hljs-built_in">Object</span>.keys(next)
  <span class="hljs-keyword">const</span> keys = currKeys
    .concat(nextKeys)
    .filter(<span class="hljs-function">(<span class="hljs-params">v, i, self</span>) =&gt;</span> self.indexOf(v) === i)

  <span class="hljs-keyword">const</span> baseScore = keys
    .map(<span class="hljs-function"><span class="hljs-params">k</span> =&gt;</span> (curr[k] || <span class="hljs-number">0</span>) * (next[k] || <span class="hljs-number">0</span>))
    .reduce(<span class="hljs-function">(<span class="hljs-params">acc, c</span>) =&gt;</span> acc + c, <span class="hljs-number">0</span>)

  <span class="hljs-keyword">const</span> currScore = keys
    .map(<span class="hljs-function"><span class="hljs-params">k</span> =&gt;</span> (curr[k] ? <span class="hljs-built_in">Math</span>.pow(curr[k], <span class="hljs-number">2</span>) : <span class="hljs-number">0</span>))
    .reduce(<span class="hljs-function">(<span class="hljs-params">acc, c</span>) =&gt;</span> acc + c, <span class="hljs-number">0</span>)

  <span class="hljs-keyword">const</span> nextScore = keys
    .map(<span class="hljs-function"><span class="hljs-params">k</span> =&gt;</span> (next[k] ? <span class="hljs-built_in">Math</span>.pow(next[k], <span class="hljs-number">2</span>) : <span class="hljs-number">0</span>))
    .reduce(<span class="hljs-function">(<span class="hljs-params">acc, c</span>) =&gt;</span> acc + c, <span class="hljs-number">0</span>)

  <span class="hljs-keyword">const</span> score = baseScore
    ? baseScore / (<span class="hljs-built_in">Math</span>.sqrt(currScore) * <span class="hljs-built_in">Math</span>.sqrt(nextScore))
    : <span class="hljs-number">0</span>
  <span class="hljs-keyword">const</span> words = keys.filter(<span class="hljs-function"><span class="hljs-params">k</span> =&gt;</span> curr[k] &amp;&amp; next[k])
  <span class="hljs-keyword">return</span> { score, words }
}</code></pre><h3>実行結果</h3><p>うーん、全然関係ない単語でしか一致しない、、、その通りではあるんだけど</p><pre><code>babel-node source/js/similarity &quot;content/posts/js/cosine-similarity.md&quot; &quot;content&quot;

25.26%  content\posts\2016-05-23\github-cli.md  com, https, mijime, github
0%      content\posts\2016-05-26\border-implement.md
0%      content\posts\2016-05-26\ci-is-difficult.md
0%      content\posts\blog\first-blogged.md
0%      content\posts\hugo\code-mermaid.md
20.9%   content\posts\hugo\hugo-deploy.md       branch, content
100%    content\posts\js\cosine-similarity.md   100, 2016, 89571, MeCab, コサイン
9.93%   content\posts\blog\blog-of-policy.md    branch, posts, slides
1.98%   content\posts\hugo\hugo-pagination.md   html, pagination
3.52%   content\slides\2016-05-27\my-first-slide.md     html
</code></pre></div><div class="flex justify-end py-2"><button class="github-edit-button_githubButton__-uLd7"><a href="https://github.com/mijime/mijime.github.io/edit/master/pages/post/js/cosine-similarity/index.md">Edit</a></button></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/post/js/cosine-similarity","query":{},"buildId":"zGlGN353iEv7lWCF6iQT6","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-258b42e5eecc223c2582.js"></script><script src="/_next/static/chunks/main-68ca09d5e091eab3c5ab.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.d2ae4074d0a54d95f68e.js" async=""></script><script src="/_next/static/chunks/commons.7394d07e57118caf40be.js" async=""></script><script src="/_next/static/chunks/pages/_app-9ecc240cedbde30f7a8f.js" async=""></script><script src="/_next/static/chunks/8d28131037b551229a39f010c44923deddaa105c.d6b252b26e2153b31569.js" async=""></script><script src="/_next/static/chunks/pages/post/js/cosine-similarity-0da4025866b8366b6686.js" async=""></script><script src="/_next/static/zGlGN353iEv7lWCF6iQT6/_buildManifest.js" async=""></script><script src="/_next/static/zGlGN353iEv7lWCF6iQT6/_ssgManifest.js" async=""></script></body></html>